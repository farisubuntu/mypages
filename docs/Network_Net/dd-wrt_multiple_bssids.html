<!DOCTYPE html>
<html lang="en">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link
	href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/css/bootstrap.min.css"
	rel="stylesheet"
	integrity="sha384-rbsA2VBKQhggwzxH7pPCaAqO46MgnOM80zW1RWuH61DGLwZJEdK2Kadq2F9CUG65"
	crossorigin="anonymous">
<link rel="stylesheet" href="../prism.css">
<link rel="stylesheet" href="../styles.css">
<style>

</style>
<body>

	<nav>
		<ul>
<li><a class="" href="../index.html">index</a></li>
<li class="heading"><span>CSS</span></li>
<ul>
<li><a class="" href="../CSS/css-media-and-rwd.html">css media and rwd</a></li>
<li><a class="" href="../CSS/css-naming-convention.html">css naming convention</a></li>
<li><a class="" href="../CSS/css_page_media.html">css page media</a></li>
<li><a class="" href="../CSS/flexbox-review.html">flexbox review</a></li>
<li><a class="" href="../CSS/grid-review.html">grid review</a></li>
<li><a class="" href="../CSS/notes_grid_or_flexbox.html">notes grid or flexbox</a></li>
<li><a class="" href="../CSS/rwd-snippets.html">rwd snippets</a></li>
<li><a class="" href="../CSS/sizing_items_in_css.html">sizing items in css</a></li>
</ul>
<li class="heading"><span>Github</span></li>
<ul>
<li><a class="" href="../Github/gcm.html">gcm</a></li>
<li><a class="" href="../Github/git-branching.html">git branching</a></li>
<li><a class="" href="../Github/git-flight-rules.html">git flight rules</a></li>
<li><a class="" href="../Github/git-gcm-configure.html">git gcm configure</a></li>
<li><a class="" href="../Github/git.html">git</a></li>
<li><a class="" href="../Github/gitpod.html">gitpod</a></li>
<li><a class="" href="../Github/integrate_github_with_wordpress.html">integrate github with wordpress</a></li>
<li><a class="" href="../Github/md-to-github.html">md to github</a></li>
</ul>
<li class="heading"><span>Leaf 3</span></li>
<ul>
<li><a class="" href="../Leaf-3/basic.html">basic</a></li>
<li><a class="" href="../Leaf-3/helpers.html">helpers</a></li>
<li><a class="" href="../Leaf-3/mvc.html">mvc</a></li>
</ul>
<li class="heading"><span>Network Net</span></li>
<ul>
<li><a class="" href="anonsurf_vpn_install.html">anonsurf vpn install</a></li>
<li><a class="" href="dd-wrt.html">dd wrt</a></li>
<li><a class="active" href="dd-wrt_multiple_bssids.html">dd wrt multiple bssids</a></li>
<li><a class="" href="ddwrt_basic_wl_settings.html">ddwrt basic wl settings</a></li>
<li><a class="" href="download_youtube_videos.html">download youtube videos</a></li>
<li><a class="" href="riseup-vpn.html">riseup vpn</a></li>
</ul>
<li class="heading"><span>PHP</span></li>
<ul>
<li><a class="" href="../PHP/22092023.html">22092023</a></li>
<li><a class="" href="../PHP/LearningResources.html">LearningResources</a></li>
<li><a class="" href="../PHP/edx_js_backend_frameworks.html">edx js backend frameworks</a></li>
<li><a class="" href="../PHP/embed_lib.html">embed lib</a></li>
<li><a class="" href="../PHP/express_mdn.html">express mdn</a></li>
<li><a class="" href="../PHP/helpful_resources.html">helpful resources</a></li>
<li><a class="" href="../PHP/html_forms.html">html forms</a></li>
<li><a class="" href="../PHP/http_response_codes.html">http response codes</a></li>
<li><a class="" href="../PHP/json_guide.html">json guide</a></li>
<li><a class="" href="../PHP/local-servers.html">local servers</a></li>
<li><a class="" href="../PHP/logical_gradation_of_developers.html">logical gradation of developers</a></li>
<li><a class="" href="../PHP/markdown.html">markdown</a></li>
<li><a class="" href="../PHP/namespace_review.html">namespace review</a></li>
<li><a class="" href="../PHP/notes_for_proff_nodejs_express.html">notes for proff nodejs express</a></li>
<li><a class="" href="../PHP/npm_quick_ref.html">npm quick ref</a></li>
<li><a class="" href="../PHP/pandoc_quick_ref.html">pandoc quick ref</a></li>
<li><a class="" href="../PHP/php_basics.html">php basics</a></li>
<li><a class="" href="../PHP/php_iterators.html">php iterators</a></li>
<li><a class="" href="../PHP/wget-ultimate-examples.html">wget ultimate examples</a></li>
</ul>
<li class="heading"><span>Packaging</span></li>
<ul>
<li><a class="" href="../Packaging/apt.html">apt</a></li>
<li><a class="" href="../Packaging/composer.html">composer</a></li>
</ul>
<li class="heading"><span>ReviewQuestions</span></li>
<ul>
<li><a class="" href="../ReviewQuestions/strings_quotes.html">strings quotes</a></li>
</ul>
<li class="heading"><span>Symfony</span></li>
<ul>
<li><a class="" href="../Symfony/Encore.html">Encore</a></li>
<li class="heading"><span>Symfonycasts</span></li>
<ul>
<li><a class="" href="../Symfony/Symfonycasts/Composer.html">Composer</a></li>
<li><a class="" href="../Symfony/Symfonycasts/Dependency Injection and the art of services and containers.html">Dependency Injection and the art of services and containers</a></li>
<li><a class="" href="../Symfony/Symfonycasts/Symfony 6 Fundamentals: Services, Config & Environments.html">Symfony 6 Fundamentals: Services, Config & Environments</a></li>
</ul>
<li><a class="" href="../Symfony/chapter5_symfonyCats.html">chapter5 symfonyCats</a></li>
<li><a class="" href="../Symfony/symfony_and_http_fundamentals.html">symfony and http fundamentals</a></li>
<li><a class="" href="../Symfony/symfony_basics.html">symfony basics</a></li>
<li><a class="" href="../Symfony/twig_basics.html">twig basics</a></li>
<li><a class="" href="../Symfony/twig_cheatsheet.html">twig cheatsheet</a></li>
</ul>
<li class="heading"><span>javascript</span></li>
<ul>
<li><a class="" href="../javascript/js_cheatsheet.html">js cheatsheet</a></li>
</ul>
</ul>
	</nav>
	<article>
	<p>Was this HowTo useful to you?</p>
<p>Revision:</p>
<p><strong>v8.0</strong> (<a href="http://www.pennock.nl/dd-wrt/Multiple_BSSIDs.html#revhistory">history</a>)</p>
<p>Last update:</p>
<p><strong>Mar 9, 2014</strong></p>
<p>I have seen several HowTos, tutorials, and forum posts about how to setup multiple (B)SSIDs using <a href="http://www.dd-wrt.com/">DD-WRT</a> and although most of these write-ups indeed helped creating multiple SSIDs, none gave me an actual <em>working</em> virtual SSID. Most of the time I wasn’t even able to connect to the new virtual interface and in those rare occassions that it did connect, I never got an IP address. The reason none of these write-ups work, is because they are all based on the same base tutorial which, for one reason or the other, no longer works reliably.</p>
<p>I took all these write-ups and figured out what is needed to get it to work again. The following HowTo is what worked for me on my <strong>Linksys WRT54GL v1.1</strong> and <strong>Linksys WRT310N</strong>. It created two BSSIDs, each with their own MAC address so any device is able to connect to either BSSID without getting utterly confused. The main BSSID has access to the internet and to your local network. The second (virtual) BSSID only has access to the internet.</p>
<p>I was only able to test it on my routers, so I would appreciate it if you dropped me an email <a href="mailto:dd-wrt@pennock.nl">here</a> to let me know if this worked for you too (or not).</p>
<h2 id="before-you-continue%E2%80%A6">Before you continue… <a class="heading-anchor-permalink" href="#before-you-continue%E2%80%A6">#</a></h2>
<p>To make things easier for you, I made this HowTo <em>interactive</em> meaning I will ask you now to enter some information about the setup you wish to create. After you have entered the information, this HowTo will automatically change to reflect your setup. If you are unsure what to enter here, just leave it as it is - you will be able to create multiple BSSIDs just fine with the default values.</p>
<p><strong>Enter the information and press <strong>“Done”</strong> when done:</strong></p>
<p><strong>Main Wireless Interface</strong></p>
<p><strong>Virtual Wireless Interface</strong></p>
<p><strong>Wireless Network Name (SSID)</strong></p>
<p><strong>IP Address</strong></p>
<p>…</p>
<p>…</p>
<p><strong>Subnet Mask</strong></p>
<p>…</p>
<p>…</p>
<p><strong>Start IP Address (DHCP)</strong></p>
<p>192.168.1.</p>
<p>192.168.2.</p>
<p><strong>End IP Address (DHCP)</strong></p>
<p>192.168.1.</p>
<p>192.168.2.</p>
<p><strong>Security Mode</strong></p>
<p><strong>WPA Algorithms</strong></p>
<h2 id="bssid-vs-ssid">BSSID vs SSID <a class="heading-anchor-permalink" href="#bssid-vs-ssid">#</a></h2>
<p>There’s much confusion about what the difference is between a SSID and a <strong>B</strong>SSID. Some routers can only create multiple SSIDs while others can create multiple <strong>B</strong>SSIDs. For now, it’s only important to know that multiple <strong>B</strong>SSIDs is what you want if your router supports it. A BSSID is a truly seperate interface with its own MAC address, while multiple SSIDs share the same MAC address confusing many wireless clients (like PDAs) causing them to be unable to see some or all of the created wireless networks.</p>
<h2 id="what-will-my-router-support%3F">What will my router support? <a class="heading-anchor-permalink" href="#what-will-my-router-support%3F">#</a></h2>
<p>If you want to know if your router supports multiple SSIDs at all, you will need to make a telnet connection to your router and query the wl0_corerev variable.</p>
<p>In Windows, click <strong>Start</strong>, <strong>Run</strong> and in the window that appears, type cmd and click <strong>OK</strong>.</p>
<p><img src="http://www.pennock.nl/dd-wrt/images/mb_cmd_2.gif" alt=""></p>
<p>A Command Prompt window will now open. In this window type</p>
<p>telnet 192.168.1.1</p>
<p>and press Enter. You will now see the DD-WRT login screen.</p>
<p><img src="http://www.pennock.nl/dd-wrt/images/mb_login_2.gif" alt=""></p>
<p>Enter “<strong>root</strong>” (without the quotes) as your login name, press Enter, then enter your password and press Enter again. You will now see yet another prompt. At the prompt, type nvram get wl0_corerev and press Enter.</p>
<p><img src="http://www.pennock.nl/dd-wrt/images/mb_corerev_2.gif" alt=""></p>
<p>A number will be printed, here’s what that number means for you:</p>
<p>0 - 4</p>
<p>You are out of luck. Your router will <strong>not</strong> do multiple (B)SSIDs.</p>
<p>5 - 8</p>
<p>Your router <em>will</em> do multiple SSIDs, but not multiple <strong>B</strong>SSIDs.</p>
<p>9 and up</p>
<p>Your router will do multiple BSSIDs. Kudos!</p>
<p>To close the telnet session, type “exit” at the prompt.</p>
<h2 id="which-version-of-dd-wrt-do-i-need%3F">Which version of DD-WRT do I need? <a class="heading-anchor-permalink" href="#which-version-of-dd-wrt-do-i-need%3F">#</a></h2>
<p>For newer routers, check the <a href="http://www.dd-wrt.com/site/support/router-database">Router Database</a> on <a href="http://dd-wrt.com">dd-wrt.com</a> to see what the latest stable version is for your router.</p>
<p>For older routers, either check the <a href="http://www.dd-wrt.com/site/support/router-database">Router Database</a>, or get one of EKO’s TNG builds. You can find them here:</p>
<p>A higher number means it’s a newer build. Always try the highest number first and if that gives problems, try a lower number. You will also notice there are several versions for each build. The most notably are the “VINT” and the “NEWD” branches. “VINT” stands for “Vintage” and you need that if you have a wl0_corerev smaller than 9. If you have a wl0_corerev of 9 or up, use one of the “NEWD” versions. “NEWD” stands for “New Driver”. Within each of these two branches, there are more subversions like “mini”, “mega”, “voip”. What this means exactly can be found elsewhere on the net. If you are unsure which file to get, just go for the “std” version. Chances are that’s what you need anyway.</p>
<h2 id="flashing-dd-wrt">Flashing DD-WRT <a class="heading-anchor-permalink" href="#flashing-dd-wrt">#</a></h2>
<p>You can also find many very good tutorials on the interwebs on how to flash a new version of DD-WRT to your router so I won’t go into much detail here. A few things to remember though. First and foremost, if your router still has its original firmware and this is the first time you are going to flash dd-wrt, please check the <a href="http://www.dd-wrt.com/wiki/index.php/Supported_Devices#Supported_Devices">Supported Devices</a> list for any special instructions (which can be found under “Notes for running dd-wrt”). Sometimes you need to flash a special version first before you can flash any of the other versions. Another thing to remember is that it’s best to reset the router to its default settings <strong>before</strong> and <strong>after</strong> you flash the new firmware. It’s not always necessary but it rules out certain problems you might encounter when you don’t.</p>
<p>There are two ways to reset the router to its factory defaults. You can either <em>telnet</em> to your router and at the prompt type these two commands:</p>
<p>erase nvram<br>
reboot</p>
<p>Or you can reset the router to its default settings using the 30/30/30/<strong>30</strong> method (yes, I added an extra “30”):</p>
<ul>
<li>Remove all cables (except the power cable) from the router.</li>
<li>Press and hold the reset button (at the back of the router) for 30 seconds.</li>
<li>While keeping the reset button pressed, remove the power cable and wait another 30 seconds.</li>
<li>Still while keeping the reset button pressed, reconnect the power cable and wait another 30 seconds.</li>
<li>Finally, release the reset button and wait another 30 seconds.</li>
<li>Reboot your router (by power cycling it)</li>
</ul>
<p>Personally, I prefer the first method for resetting my modem. :)</p>
<h2 id="setting-up-multiple-(b)ssids">Setting up Multiple (B)SSIDs <a class="heading-anchor-permalink" href="#setting-up-multiple-(b)ssids">#</a></h2>
<p>From this point onwards, I assume you already flashed the appropriate version of DD-WRT to your router. Now it’s finally time to create a second (virtual) SSID.</p>
<p>All existing HowTos I found, were creating the new virtual wireless interface as an “Unbridged” interface. And this is actually where it goes wrong. We are going to do something different. We are going to create a new bridge called “br1” and hook the new virtual wireless interface to this new bridge.</p>
<p>First point your webbrowser to your router’s web interface by typing “<a href="http://192.168.1.1">http://192.168.1.1</a>” in your browser’s address bar. If all is well, you will see something like this:</p>
<p><img src="http://www.pennock.nl/dd-wrt/images/ddwrt_s01_2.gif" alt=""></p>
<p>Now click the Wireless tab. A screen with your existing wireless interfaces will appear:</p>
<p><img src="http://www.pennock.nl/dd-wrt/images/ddwrt_s02_2.gif" alt=""></p>
<p>Click the Add button just below Virtual Interfaces and enter the following information for the new interface:</p>
<p>Wireless Network Name (SSID)</p>
<p><strong>SSIDVirtual</strong></p>
<p>Or whatever name you want to give this interface.</p>
<p>Wireless SSID Broadcast</p>
<p><strong>Enabled</strong></p>
<p>If you don’t want the SSID to be visible, choose <strong>Disabled</strong> here.</p>
<p>AP Isolation</p>
<p><strong>Disabled</strong></p>
<p>You can enable this if you don’t want clients on this interface to talk to each other.</p>
<p>Network Configuration</p>
<p><strong>Bridged</strong></p>
<p>That’s <strong>not</strong> a typo! Every other HowTo says you should choose <strong>UN</strong>bridged, but you should really choose <strong>Bridged</strong> here!</p>
<p>Click the Save button. Your screen should look something like this:</p>
<p><img src="http://www.pennock.nl/dd-wrt/images/ddwrt_s03_2.gif" alt=""></p>
<p>Now click the Wireless Security sub-tab. For each interface, choose the appropriate security mode and enter a key (if necessary). Click the Save button. Your screen will now look something like this:</p>
<p><img src="http://www.pennock.nl/dd-wrt/images/ddwrt_s04_2.gif" alt=""></p>
<p>Click the Services tab, and scroll down to the DNSMasq  frame. In the “Additional DNSMasq Options” input box, enter the following:</p>
<p>interface=br1<br>
dhcp-range=br1,192.168.2.100,192.168.2.149,255.255.255.0,1440m</p>
<p>Click the Save button.</p>
<p>This tells the router that (amongst other things) the new bridge will give connecting clients an IP address in the 192.168.2.100 - 192.168.2.149 range.</p>
<p>Now go to the Administration tab, sub-tab Commands. In the input box below Command Shell , enter the following:</p>
<p>if [ “`nvram get wan_proto`” = “pppoe” ]; then<br>
wanif=&quot;`nvram get pppoe_ifname`&quot;<br>
else<br>
wanif=&quot;`nvram get wan_ifname`&quot;<br>
fi</p>
<p># Make sure br1 has access to the internet:<br>
iptables -I INPUT -i br1 -m state --state NEW -j logaccept<br>
iptables -I FORWARD -i br1 -o $wanif -m state --state NEW -j ACCEPT<br>
# Keep the two wireless networks from talking to each other:<br>
iptables -I FORWARD -i br0 -o br1 -j logdrop<br>
iptables -I FORWARD -i br1 -o br0 -j logdrop<br>
# Keep br1 from accessing the router:<br>
iptables -I INPUT -i br1 -p tcp --dport telnet -j REJECT --reject-with tcp-reset<br>
iptables -I INPUT -i br1 -p tcp --dport ssh -j REJECT --reject-with tcp-reset<br>
iptables -I INPUT -i br1 -p tcp --dport www -j REJECT --reject-with tcp-reset<br>
iptables -I INPUT -i br1 -p tcp --dport https -j REJECT --reject-with tcp-reset</p>
<p>iptables -t nat -I POSTROUTING -o `get_wanface` -j SNAT --to `nvram get wan_ipaddr`</p>
<p>Click the Save Firewall button.</p>
<p>In the same input box (which is now empty again), we need to enter a startup script to create the new bridge, move the virtual wireless interface to it, and setup the new interface’s IP address. But for it all to work, we need to properly setup NAS. But <strong>how</strong> NAS needs to be setup depends on the security settings for each wireless interface. At the start of this HowTo, I asked you to enter the proper security settings for each interface. This information has been used to generate the code below. If you need different security settings, change it at the start of the HowTo and come back here.</p>
<p># Set some important values:<br>
nvram set dnsmasq_enable=1<br>
if [ “`nvram get dhcpfwd_enable`” = “0” ]; then<br>
nvram set dns_dnsmasq=1<br>
nvram set dhcp_dnsmasq=1<br>
nvram set auth_dnsmasq=1<br>
fi</p>
<p># Create bridge br1, move the virtual wireless interface to it,<br>
# and setup the interface’s IP address:<br>
brctl addbr br1<br>
brctl delif br0 wl0.1<br>
brctl addif br1 wl0.1<br>
ifconfig br1 192.168.2.1 netmask 255.255.255.0<br>
ifconfig br1 up</p>
<p># Properly setup NAS<br>
killall nas</p>
<p># Main:<br>
nas -P /tmp/nas.wl0lan.pid -H 34954 -l br0 \<br>
-i “`nvram get wl0_ifname`” -A -m 4 -k “`nvram get wl0_wpa_psk`” \<br>
-s “`nvram get wl0_ssid`” -w 2 \<br>
-g “`nvram get wl0_wpa_gtk_rekey`”</p>
<p># Virtual interface #1:<br>
nas -P /tmp/nas.wl0.1lan.pid -H 34954 -l br1 \<br>
-i wl0.1 -A -m 4 -k “`nvram get wl0.1_wpa_psk`” \<br>
-s “`nvram get wl0.1_ssid`” -w 2 \<br>
-g “`nvram get wl0.1_wpa_gtk_rekey`”</p>
<p>Now copy and paste the code from the box above into the Command Shell  input box.</p>
<p>Click the Save Startup button.</p>
<p>Finally, click the Management sub-tab, scroll down and click the Reboot Router button.</p>
<p>Wait until your router has rebooted itself and you should now have two working (B)SSIDs!</p>
<p>If you can’t connect to the virtual interface, wait 5 minutes and try again. Sometimes, for reason completely unknown to me, it takes a few minutes before the virtual interface actually starts working. If waiting doesn’t help, then you probably have some left-over configuration settings that are messing with the virtual interface. Try resetting your router to its factory default (see the part about resetting to factory default under “Flashing DD-WRT” above) and try the HowTo again. Be aware though that resetting your router to factory default means you will loose all your settings like port forwarding rules, MAC cloning, etc. So write down all your settings before resetting your router.</p>
<p>Revision History</p>
<p>v8.0</p>
<p>Mar 9, 2014</p>
<p>Apparently this HowTo didn’t work (properly) with newer routers. People were able to create multiple BSSIDs but the virtual wireless interfaces had no internet access. To solve this I’ve made some changes to the firewall script.</p>
<p>v7.0</p>
<p>Sept 7, 2009</p>
<p>Some people who connected to the internet through PPPoE reported the HowTo did not work for them. I made a small change in the firewall script which should hopefully solve the problem.</p>
<p>v6.0</p>
<p>Aug 8, 2009</p>
<p>I got myself a Linksys WRT310N and found out my HowTo did not result in working multiple BSSIDs on this router. After some experimenting I found out why and I have now corrected the HowTo so it works on more routers.</p>
<p>v5.0</p>
<p>May 2, 2009</p>
<p>Newer EKO firmwares did not work with this HowTo because it created an IP conflict between interface br1 and wl0.1. This has been fixed and this HowTo should now also work with the newer firmware versions.</p>
<p>v4.1</p>
<p>Dec. 19, 2008</p>
<p>I actually reverted some of the changes I made in the previous revision of this HowTo because WEP still didn’t work as it should. As it is now, I don’t experience any problems with WEP at all, but if you do, please let me know.</p>
<p>v4.0</p>
<p>Dec. 13, 2008</p>
<p>If you set the security mode to WEP for one or both of the interfaces, the NAS settings didn’t work causing the router to be unable to issue an IP address for the wireless interface. This has been fixed.</p>
<p>v3.0</p>
<p>Nov. 28, 2008</p>
<p>I removed the PPPoE tick box again since the WAN interface can actually be anything (and not either “vlan1” or “ppp0” as I assumed). This version of the HowTo creates code that should work with whatever your WAN interface’s name is (“vlan1”, “vlan2”, “ppp0”, etc.).</p>
<p>v2.0</p>
<p>Nov. 18, 2008</p>
<p>I assumed the WAN interface was always “vlan1” but when your router is setup as PPPoE, then the WAN interface is “ppp0”. I added a tick box where you can specify wether or not you are using PPPoE.</p>
<p>v1.0</p>
<p>Oct. 10, 2008</p>
<p>Original Document</p>

	</article>
	<script src="../prism.js"></script>
	<script>prism.Highlight();</script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.2.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-kenU1KFdBIe4zVF0s0G1M5b4hcpxyD9F7jL+jjXkk+Q2h455rYXK/7HAuoJl+0I4" crossorigin="anonymous"></script>
</body>

</html>